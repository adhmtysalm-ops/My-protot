<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Admin - Adham Atya</title>
    <style>
        body { background: #0a0a0a; color: #D4AF37; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .box { background: #111; padding: 30px; border: 1px solid #333; border-radius: 10px; text-align: center; width: 350px; }
        input, select, button { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #444; color: #fff; border-radius: 5px; }
        button { background: #D4AF37; color: black; font-weight: bold; cursor: pointer; }
        #uploadSection { display: none; }
    </style>
</head>
<body>

    <div id="loginSection" class="box">
        <h2>ğŸ”’ Admin Access</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="loginBtn">Login</button>
    </div>

    <div id="uploadSection" class="box">
        <h2>ğŸš€ Add Work</h2>
        <input type="text" id="p_title" placeholder="Project Title">
        <select id="p_category">
            <option value="Branding">Branding</option>
            <option value="Packaging">Packaging</option>
            <option value="Art Direction">Art Direction</option>
            <option value="Typography">Typography</option>
            <option value="Web Design">Web Design</button>
            <option value="3D Design">3D Design</button>
        </select>
        
        <p style="font-size: 12px; color: #888; text-align:left;">Image Filename (e.g. 10.png)</p>
        <input type="text" id="p_imageName" placeholder="10.png">
        
        <button id="addBtn">Add to Portfolio</button>
        <p id="status" style="margin-top:10px; color:white;"></p>
        <button onclick="location.reload()" style="background:#c0392b; color:white; margin-top:15px;">Logout</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAKIka5HU3X_g0TLWknUEtOu6ydFsvLU8E",
            authDomain: "adham-ayta.firebaseapp.com",
            projectId: "adham-ayta",
            storageBucket: "adham-ayta.firebasestorage.app",
            messagingSenderId: "584582572316",
            appId: "1:584582572316:web:ff476d21cfaab3c49af2d9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('uploadSection').style.display = 'block';
            }
        });

        // Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('loginBtn').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, email, pass).catch(e => alert(e.message));
        });

        // Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        document.getElementById('addBtn').addEventListener('click', async () => {
            const title = document.getElementById('p_title').value;
            const category = document.getElementById('p_category').value;
            let imageName = document.getElementById('p_imageName').value.trim();
            const status = document.getElementById('status');

            if (!title || !imageName) { alert("Please fill all fields"); return; }
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø§Ø³Ù…: Ù„Ùˆ ÙƒØªØ¨Øª ÙÙŠÙ‡ / Ø¨Ø§Ù„ØºÙ„Ø· Ù‡Ù†Ø´ÙŠÙ„Ù‡Ø§ Ø®Ø§Ù„Øµ
            if(imageName.startsWith('/')) imageName = imageName.substring(1);
            
            // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø§Ù„Ù…Ø³Ø§Ø± Ø¨Ù‚Ù‰ Ø§Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø³ Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø·Ø© Ù…Ø§Ø¦Ù„Ø©
            const finalPath = imageName;

            status.innerText = "Saving...";

            try {
                await addDoc(collection(db, "portfolio_items"), {
                    title: title,
                    category: category,
                    imageUrl: finalPath, // Ù‡ÙŠØªØ­ÙØ¸ ÙƒÙ€ "10.png" Ù…Ø´ "/10.png"
                    createdAt: serverTimestamp()
                });
                status.innerText = "Success!";
                alert("Project Added Successfully!");
                document.getElementById('p_title').value = '';
                document.getElementById('p_imageName').value = '';
            } catch (err) {
                console.error(err);
                status.innerText = "Failed.";
                alert("Access Denied: Check Rules.");
            }
        });
    </script>
</body>
</html>
